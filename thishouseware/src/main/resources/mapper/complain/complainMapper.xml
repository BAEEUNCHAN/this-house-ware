<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.contractor.app.complain.mapper.ComplainMapper">

<!-- 문의 전체조회 -->
<select id="selectComplainAll" resultType="ComplainsVO">
	
	SELECT		c.complain_no
				,c.complain_dt
				,c.complain_content
				,c.complain_request
				,c.upload_dt
				,c.progress
				,c.complain_type
				,c.company_no
                ,p.company_name
	FROM		complains c JOIN companys p
    ON          c.company_no = p.company_no
	ORDER BY    company_no

</select>

<!-- 문의 등록 -->
<insert id="insertComplainInfo" parameterType="ComplainsVO">
	
	<selectKey keyProperty="complainNo"
			   resultType="Integer"
			   order="BEFORE">
		<!-- 1001부터 시작 -->
		SELECT NVL(MAX(complain_no), 1) + 1
		FROM   companys
	</selectKey>
	
	INSERT INTO complains(complain_no
						 ,complain_dt
						 ,complain_title
						 ,complain_content
						 ,complain_request
						 ,upload_dt
						 .progress
						 ,complain_type
						 ,company_no)
	VALUES				 (#{complainNo}
						 ,#{complainDt}
						 ,#{complainTitle}
						 ,#{complainContent}
						 ,#{complainRequest}
						 ,#{uploadDt}
						 ,#{progress}
						 ,#{complainType}
						 ,#{companyNo})
</insert>

</mapper>