<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/default_layout}" layout:fragment="Content">
<head>
<meta charset="UTF-8">
<title>결재라인 조회</title>
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<style>
/* 기본 체크박스 숨기기 */
.chk_box input[type="checkbox"] {
	display: none; /* 체크박스 숨기기 */
}

/* 체크박스 스타일 */
.chk_box {
	cursor: pointer; /* 커서 포인터로 변경 */
	position: relative; /* 상대 위치 지정 */
}

/* 기본 별 아이콘 색상 */
.chk_box .fa-star {
	color: #6c757d; /* 기본 색상 */
	font-size: 20px; /* 별 아이콘 크기 조정 */
}

/* 체크된 상태의 별 아이콘 색상 */
.chk_box input[type="checkbox"]:checked+.fa-star {
	color: #ffc107; /* 체크 시 별 색상 변경 */
}
</style>
</head>
<body>
	<div class="page-inner">
		<div class="row">
			<div class="col-md-12">
				<div class="card">
					<div class="card-header">
						<div class="card-title">결재라인 조회</div>
					</div>
					<div class="card-body">
						<div class="row">
							<div class="text-center">
								<table class="table">
									<thead>
										<tr>
											<th><input type="checkbox" id="checkAll"></th>
											<th class=hidden style="display: none">결재라인번호</th>
											<th>번호</th>
											<th>결재라인이름</th>
											<th>생성일자</th>
											<th>최근사용일자</th>
											<th>즐겨찾기</th>
											<th></th>
										</tr>
									</thead>
									<tbody class="apprLines">
										<th:block th:each="info,sts : ${apprLines}">
											<tr th:data-lineno="${info.approvalLineNo}">
												<td><input type="checkbox" class="rowCheck" th:value="${info.approvalLineNo}"></td>
												<!-- 자체순번 / 문서는 최근 문서순 정렬 -->
												<td class=hidden style="display: none;">[[${{info.approvalLineNo}}]]</td>
												<td>[[${sts.count}]]</td>
												<td>[[${info.approvalLineName}]]</td>
												<td>[[${#dates.format(info.createDt, 'yyyy-MM-dd')}]]</td>
												<td>[[${#dates.format(info.recentUsedDt, 'yyyy-MM-dd')}]]</td>
												<td><label class="chk_box"> 
												<input type="checkbox" th:checked="${info.favoriteChk == 'Y'}" />
														<i class="fa fa-star" aria-hidden="true"></i>
												</label></td>
												<td><button id="modifyButton" class="btn btn-warning btn-sm" style="width: 80px; margin-right: 5px;">수정</button></td>
											</tr>
										</th:block>
									</tbody>
								</table>
								<div class="d-flex justify-content-end" style="padding: 10px;">
									<button id="addButton" class="btn btn-info btn-sm" style="width: 80px; margin-right: 5px;">추가</button>
									<button id="deleteButton" class="btn btn-success btn-sm" style="width: 80px;">삭제</button>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- 결재자 리스트 -->
				<div class="apprList">
				</div>
			</div>
		</div>
	</div>

	<script>
		// 체크박스 전체 선택/해제 기능
		$('#checkAll').on('click', function() {
			$('.rowCheck').prop('checked', this.checked);
		});

		// 각 행 클릭시 리스트 및 등록 폼 출력
		$('.apprLines').on('click', 'tr', function(event) {
			if (!$(event.target).is('input[type="checkbox"]')) {
				//let edno = $(this).children().eq(1).text();
				let approvalLineNo =$(event.currentTarget).data("lineno")
				//let url = 'apprLineInfo?approvalLineNo=' + edno;
				//location.href = url;
				$.ajax({
					type : 'GET',
					url : '/appr/apprList?approvalLineNo='+approvalLineNo,
					
					success : function(response) {
						$(".apprList").html(response)
					},
					error : function() {
						alert('오류가 발생했습니다.');
					}
				});
			}
		});

		// 즐겨찾기 체크박스 클릭 시 이벤트 전파 방지
		$('.chk_box').on('click', function(event) {
			event.stopPropagation(); // 이벤트 전파 방지
		});

		// 추가 버튼 클릭 시 동작
		$('#addButton').on('click', function() {
			location.href = '/appr/apprLineInsert';
		});

		// 삭제 버튼 클릭 시 동작
		$('#deleteButton').on('click', function() {
			let selectedIds = [];
			$('.rowCheck:checked').each(function() {
				selectedIds.push($(this).val());
			});

			if (selectedIds.length > 0) {
				if (confirm('선택한 결재라인을 삭제하시겠습니까?')) {
					$.ajax({
						type : 'POST',
						url : '/appr/apprLineDelete',
						data : JSON.stringify(selectedIds),
						contentType : 'application/json',
						success : function(response) {
							alert('삭제되었습니다.');
							location.reload();
						},
						error : function() {
							alert('삭제 중 오류가 발생했습니다.');
						}
					});
				}
			} else {
				alert('삭제할 결재라인을 선택하세요.');
			}
		});
	</script>
</body>
</html>