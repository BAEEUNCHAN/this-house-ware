<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/default_layout}" layout:fragment="Content">
<head>
<meta charset="UTF-8">
<title>결재라인 조회</title>
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<style>
/* 기본 체크박스 숨기기 */
.chk_box input[type="checkbox"] {
	display: none; /* 체크박스 숨기기 */
}

/* 체크박스 스타일 */
.chk_box {
	cursor: pointer; /* 커서 포인터로 변경 */
	position: relative; /* 상대 위치 지정 */
}

/* 기본 별 아이콘 색상 */
.chk_box .fa-star {
	color: #6c757d; /* 기본 색상 */
	font-size: 20px; /* 별 아이콘 크기 조정 */
}

/* 체크된 상태의 별 아이콘 색상 */
.chk_box input[type="checkbox"]:checked+.fa-star {
	color: #ffc107; /* 체크 시 별 색상 변경 */
}
</style>
</head>
<body>
	<div class="page-inner">
		<div class="row">
			<div class="col-md-12">
				<div class="card">
					<div class="card-header">
						<div class="card-title">결재자 조회</div>
					</div>
					<div class="card-body">
						<div class="row">
							<div class="text-center">
								<table class="table">
									<thead>
										<tr>
											<th><input type="checkbox" id="checkAll"></th>
											<th>번호</th>
											<th>결재선이름</th>
											<th>생성일자</th>
											<th>최근사용일자</th>
											<th>즐겨찾기</th>
										</tr>
									</thead>
									<tbody class="apprs">
										<th:block th:each="info : ${apprLines}">
											<tr>
												<td><input type="checkbox" class="rowCheck"
													th:value="${info.approvalLineNo}"></td>
												<td th:text="${info.approvalLineNo}">결재선 번호</td>
												<td th:text="${info.approvalLineName}">결재선 이름</td>
												<td th:text="${#dates.format(info.createDt, 'yyyy-MM-dd')}">생성일자</td>
												<td th:text="${#dates.format(info.recentUserDt, 'yyyy-MM-dd')}">최근사용일자</td>
												<td><label class="chk_box"> 
												<input type="checkbox" th:checked="${info.favoriteChk == 'Y'}" />
														<i class="fa fa-star" aria-hidden="true"></i>
												</label></td>
											</tr>
										</th:block>
									</tbody>
								</table>
								<div class="d-flex justify-content-end" style="padding: 10px;">
									<button id="addButton" class="btn btn-info btn-sm" style="width: 80px; margin-right: 5px;">추가</button>
									<button id="deleteButton" class="btn btn-success btn-sm" style="width: 80px;">삭제</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>
		// 체크박스 전체 선택/해제 기능
		$('#checkAll').on('click', function() {
			$('.rowCheck').prop('checked', this.checked);
		});

		// 각 행 클릭 시 상세 페이지 이동
		$('.apprs').on('click', 'tr', function(event) {
			if (!$(event.target).is('input[type="checkbox"]')) {
				let edno = $(this).children().eq(1).text();
				let url = 'apprLineInfo?approvalLineNo=' + edno;
				location.href = url;
			}
		});

		// 즐겨찾기 체크박스 클릭 시 이벤트 전파 방지
		$('.chk_box').on('click', function(event) {
			event.stopPropagation(); // 이벤트 전파 방지
		});

		// 추가 버튼 클릭 시 동작
		$('#addButton').on('click', function() {
			location.href = '/appr/apprLineInsert';
		});

		// 삭제 버튼 클릭 시 동작
		$('#deleteButton').on('click', function() {
			let selectedIds = [];
			$('.rowCheck:checked').each(function() {
				selectedIds.push($(this).val());
			});

			if (selectedIds.length > 0) {
				if (confirm('선택한 결재선을 삭제하시겠습니까?')) {
					$.ajax({
						type : 'POST',
						url : '/appr/apprLineDelete',
						data : JSON.stringify(selectedIds),
						contentType : 'application/json',
						success : function(response) {
							alert('삭제되었습니다.');
							location.reload();
						},
						error : function() {
							alert('삭제 중 오류가 발생했습니다.');
						}
					});
				}
			} else {
				alert('삭제할 결재선을 선택하세요.');
			}
		});
	</script>
</body>
</html>