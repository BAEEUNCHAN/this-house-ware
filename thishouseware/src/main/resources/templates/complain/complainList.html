<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/default_layout}"
	layout:fragment="Content">
<body>


	<div class="container">
		<div class="page-inner">
			<div class="page-header">
				<h3 class="fw-bold mb-3">불편/장애사항</h3>
				<ul class="breadcrumbs mb-3">
					<li class="nav-home"><a href="#"> <i class="icon-home"></i>
					</a></li>
					<li class="separator"><i class="icon-arrow-right"></i></li>
					<li class="nav-item"><a href="#">고객관리</a></li>
					<li class="separator"><i class="icon-arrow-right"></i></li>
					<li class="nav-item"><a href="#">불편/장애사항 목록</a></li>
				</ul>
			</div>


			<div class="page-inner">
				<div class="row">
					<div class="col-md-12">
						<div class="card">
							<div class="card-header">
								<div class="card-title">
									불편/장애사항 목록<a href="/insertComplain" class="float-end"><button
											class="btn btn-primary">문의등록</button></a>
								</div>
							</div>
							<div class="card-body">
								<div class="row">
									<div class="text-center">
										<table class="table" id="table">
											<thead>
												<tr>
													<th class="col-md-1">No</th>
													<th class="col-md-3">제목</th>
													<th class="col-md-2">고객명</th>
													<th class="col-md-2">회사명</th>
													<th class="col-md-2">처리상황</th>
													<th class="col-md-2">작성날짜</th>
													<th class="col-md-1"></th>
													<!-- yyyy년MM월dd일 -->
												</tr>
											</thead>
											<tbody>
												<th:block th:each="info : ${complains}">
													<!-- 조건, 반복문 있을 때 구분하기 위해 th:block -->
													<tr>
														<!-- 여기 onclick 넣어도 됨. -->
														<td>[[${info.complainNo}]]</td>
														<td>[[${info.complainTitle}]]</td>
														<td>[[${info.customerName}]]</td>
														<td>[[${info.companyName}]]</td>
														<td><span th:switch="${info.progress}"> <span
																th:case="0">대기</span> <span th:case="1">접수</span> <span
																th:case="2">진행</span> <span th:case="3">상황완료</span> <span
																th:case="4">보고완료</span>
														</span></td>
														<td>[[${#dates.format(info.uploadDt, 'yyyy-MM-dd')}]]</td>

														<td>
															<button type="button" class="btn btn-danger alert_demo_7"
																data-toggle="modal" data-target="#exampleModal" th:value="info">
																<i class="icon-trash"></i>
															</button>
														</td>
													</tr>
												</th:block>
											</tbody>
										</table>
									</div>
								</div>

	<div class="page-inner">
		<div class="row">
			<div class="col-md-12">
				<div class="card">
					<div class="card-header">
						<div class="card-title">불편/장애 진행상황 목록</div>
					</div>
					<div class="card-body">
						<div class="row">
							<div class="text-center">
								<table class="table">
									<thead>
										<tr>
											<th class="col-md-2">No</th>
											<th class="col-md-5">제목</th>
											<th class="col-md-2">회사번호</th>
											<th class="col-md-2">회사명</th>
											<th class="col-md-4">작성날짜</th>
											<!-- yyyy년MM월dd일 -->
										</tr>
									</thead>
									<tbody>
										<th:block th:each="info : ${complains}">
											<!-- 조건, 반복문 있을 때 구분하기 위해 th:block -->
											<tr>
												<!-- 여기 onclick 넣어도 됨. -->
												<td>[[${info.complainNo}]]</td>
												<td>[[${info.complainTitle}]]</td>
												<td>[[${info.companyNo}]]</td>
												<td>[[${info.companyName}]]</td>
												<td>[[${info.uploadDt}]]</td>
											</tr>
										</th:block>
									</tbody>
								</table>

							</div>
						</div>
					</div>
				</div>
			</div>


		</div>
	</div>

           
            




	<script>
	
		// 삭제모달
		 //== Class definition
              var SweetAlert2Demo = (function () {
                //== Demos
                var initDemos = function () {
                  $(".alert_demo_7").click(function (e) {
                	  event.stopPropagation();
                	  let complainNo = $(e.currentTarget).closest('tr').children().first().text();
                    swal({
                      title: "불편/장애사항 삭제",
                      text: "문의사항을 삭제하시겠습니까?",
                      type: "warning",
                      buttons: {
                        confirm: {
                          text: "삭제",
                          className: "btn btn-danger",
                        },
                        cancel: {
                        	text: "취소",
                          visible: true,
                          className: "btn btn-black",
                        },
                      },
                    }).then((Delete) => {
                      if (Delete) {
                    	  
                    	  $.ajax({
                              url: `/complainDelete?complainNo=${complainNo}`, 
                              type: 'DELETE',
                              success: function (response) {
                                  swal({
                                      title: "삭제완료!",
                                      text: "해당 문의사항이 삭제되었습니다.",
                                      icon: "success",
                                      buttons: {
                                          confirm: {
                                              text: "확인",
                                              className: "btn btn-success",
                                          },
                                      },
                                  }).then(() => {
                                      location.reload();
                                  });
                              },
                              error: function (error) {
  								swal(
  										 {
  									title: "오류!",
  									text: "삭제 중 오류가 발생했습니다. 다시 시도해 주세요.",
  									icon: "error",
  									buttons: {
  										confirm: {
  											text: "확인",
  											className: "btn btn-danger",
  										},
  									},
  								} 
  										).then(() => {
  									//location.reload();
  								});
  							}  
                          });
                      } else {
                          swal.close();
                      }
                  });
              });
        
                };
        
                return {
                  //== Init
                  init: function () {
                    initDemos();
                  },
                };
              })();
        
              //== Class Initialization
              jQuery(document).ready(function () {
                SweetAlert2Demo.init();
              });
	
	
		//제이쿼리 객체 생성
		$('tbody > tr').on('click', function(event) {
			//event.target
			let trTag = event.currentTarget;
			let complainNo = $(trTag).children().first().text();
			let url = `/complainInfo?complainNo=${complainNo}`;
			location.href = url;
		});
	</script>
</body>
</html>