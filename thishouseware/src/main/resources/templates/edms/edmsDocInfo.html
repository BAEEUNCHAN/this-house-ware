<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/default_layout}"
	layout:fragment="Content">
<style>
/* 테이블 스타일 */
table {
	width: 100%;
	border-collapse: collapse;
	margin: 20px 0;
	font-size: 16px;
	text-align: left;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* 테이블 헤더 스타일 */
th, td {
	padding: 12px;
	border-bottom: 1px solid #ddd;
}

th {
	background-color: #f4f4f4;
	font-weight: bold;
}

/* 라벨 스타일 */
label {
	font-weight: bold;
	margin-right: 10px;
}

/* 테이블 데이터 스타일 */
td span {
	display: block;
	color: #333;
}

/* 테이블 행 배경색 (홀수 행 스타일) */
tr:nth-child(odd) {
	background-color: #f9f9f9;
}

/* 버튼을 가운데 정렬 */
.button-container {
	text-align: center;
	margin-top: 20px;
}

button {
	padding: 10px 20px;
	background-color: #007bff;
	color: white;
	border: none;
	border-radius: 4px;
	cursor: pointer;
}

button:hover {
	background-color: #0056b3;
}

/* 추가된 결재/반려 버튼 스타일 */
.custom-approve-btn {
	background-color: #28a745;
	color: white;
	padding: 10px 20px;
	border-radius: 4px;
	font-size: 16px;
	margin: 5px;
	cursor: pointer;
}

.custom-approve-btn:hover {
	background-color: #218838;
}

.custom-reject-btn {
	background-color: #dc3545;
	color: white;
	padding: 10px 20px;
	border-radius: 4px;
	font-size: 16px;
	margin: 5px;
	cursor: pointer;
}

.custom-reject-btn:hover {
	background-color: #c82333;
}

/* 반려 사유 모달 스타일 */
#rejectModal {
	display: none;
	position: fixed;
	z-index: 1;
	left: 0;
	top: 0;
	width: 100%;
	height: 100%;
	background-color: rgba(0, 0, 0, 0.5);
}

#rejectModal .modal-content {
	background-color: #fff;
	margin: 15% auto;
	padding: 20px;
	border: 1px solid #888;
	width: 400px;
	border-radius: 8px;
}

#rejectModal textarea {
	width: 100%;
	height: 100px;
	margin-top: 10px;
}

#rejectModal .modal-footer {
	text-align: right;
	margin-top: 10px;
}
</style>

<div class="page-inner">
	<div class="row">
		<div class="col-md-12">
			<div class="card">
				<div class="card-header">
					<div class="card-title">결재문서 조회</div>
				</div>
				<div class="card-body">
					<div class="row">
						<div class="text-center">
							<table class="table">
								<tr>
									<td><label for="dno">문서번호</label></td>
									<td><span th:text="${edmsDocs.edmsDocNo}"></span></td>
								</tr>
								<tr>
									<td><label for="did">기안자</label></td>
									<td><span th:text="${edmsDocs.id}"></span></td>
								</tr>
								<tr>
									<td><label for="dtitle">제목</label></td>
									<td><span th:text="${edmsDocs.title}"></span></td>
								</tr>
								<tr>
									<td><label for="dcontent">내용</label></td>
									<input name="imageLink" type="hidden" th:value="${edmsDocs.fileName}" />
									<td><img id="edmsImg" class="card-img-top" alt="기안 이미지" width="400px" height="1500px"></td>
								</tr>
								<tr>
									<td><label for="datt">첨부파일명</label></td>
									<td>
										<a th:if="${edmsDocs.attatch != null}" th:href="@{'fileDownload?fileLink=' + ${edmsDocs.attatch}}">파일 다운로드</a>
										<br>
									</td>
								</tr>
								<tr>
									<td><label for="dsub">상신일시</label></td>
									<td><span th:text="${#dates.format(edmsDocs.submitDt, 'yyyy-MM-dd')}"></span></td>
								</tr>
								<tr>
									<td><label for="dappr">결재일시</label></td>
									<td><span th:text="${#dates.format(edmsDocs.approvalDt, 'yyyy-MM-dd')}"></span></td>
								</tr>
								<tr>
									<td><label for="dstate">결재상태</label></td>
									<td><span th:text="${edmsDocs.approvalStatus}"></span></td>
								</tr>
								<tr>
									<td><label for="dformn">결재양식번호</label></td>
									<td><span th:text="${edmsDocs.edmsFormNo}"></span></td>
								</tr>
								<tr>
									<td><label for="dshare">공유폴더 여부</label></td>
									<td><span th:text="${edmsDocs.shareStatus}"></span></td>
								</tr>
								<tr>
									<td><label for="dsharen">공유폴더 번호</label></td>
									<td><span th:text="${edmsDocs.shareFolderNo}"></span></td>
								</tr>
							</table>
							
							<div class="button-container">
								<button type="button" id="listButton">목록</button>
								<button type="button" class="custom-approve-btn" id="approveButton">승인</button>
								<button type="button" class="custom-reject-btn" id="rejectButton">반려</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- 반려 사유 모달 -->
<div id="rejectModal">
	<div class="modal-content">
		<h4>반려 사유 입력</h4>
		<textarea id="rejectReason" placeholder="반려 사유를 입력하세요"></textarea>
		<div class="modal-footer">
			<button id="confirmReject" class="custom-reject-btn">반려 확인</button>
			<button id="closeModal" class="custom-approve-btn">닫기</button>
		</div>
	</div>
</div>

<script th:inline="javascript">
	const imgLink = $('input[name=imageLink]').val();
	$('#edmsImg').attr({src: "/upload/" + imgLink});

	$(document).ready(function() {
	    let params = new URLSearchParams(window.location.search);
	    let fromDocList = params.get('fromDocList');
	    let fromDocDeptList = params.get('fromDocDeptList');
	    let id = /*[[${#authentication.principal.empVO.id}]]*/ 'default_id';
	    let deptNo = /*[[${#authentication.principal.empVO.departmentNo}]]*/ 'default_deptNo';

	    $('#listButton').on('click', function() {
	        if (fromDocList === 'true') {
	            location.href = '/docBox/docList?id=' + id;
	        } else if (fromDocDeptList === 'true') {
	            location.href = '/docBox/docDeptList?id=' + id + '&departmentNo=' + deptNo;
	        } else {
	            location.href = '/edms/edmsDocList';
	        }
	    });
	});

	$('#approveButton').on('click', function() {
	    let edmsDocNo = /*[[${edmsDocs.edmsDocNo}]]*/ 'defaultDocNo';
	    $.ajax({
	        type: 'POST',
	        url: '/edms/approve',
	        data: { edmsDocNo: edmsDocNo },
	        success: function(response) {
	            alert(response);
	            location.reload();
	        },
	        error: function(error) {
	            alert("승인 처리 중 오류가 발생했습니다.");
	        }
	    });
	});

	$('#rejectButton').on('click', function() {
	    $('#rejectModal').show(); // 반려 사유 모달을 표시
	});

	$('#closeModal').on('click', function() {
	    $('#rejectModal').hide(); // 모달 닫기
	});

	$('#confirmReject').on('click', function() {
	    let edmsDocNo = /*[[${edmsDocs.edmsDocNo}]]*/ 'defaultDocNo';
	    let reason = $('#rejectReason').val();
	    if (reason) {
	        $.ajax({
	            type: 'POST',
	            url: '/edms/reject',
	            data: { edmsDocNo: edmsDocNo, reason: reason },
	            success: function(response) {
	                alert(response);
	                location.reload();
	            },
	            error: function(error) {
	                alert("반려 처리 중 오류가 발생했습니다.");
	            }
	        });
	    } else {
	        alert("반려 사유를 입력해야 합니다.");
	    }
	});
</script>
</html>